<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="eform">


    <select id="selectEformMaster" parameterType="hashmap" resultType="camelMap" fetchSize="10000">
        SELECT
            UUID,
            CONTRACT_NUMBER,
            PEN_ID,
            EFORM_TYPE,
            RETURN_URL,
            EFORM_STATUS,
            SEQ,
            COMPANY_ID,
            REGISTER_DATE
        FROM EFORM_MASTER_TABLE
        WHERE UUID = #{uuid}
        AND CONTRACT_NUMBER = #{penOrdId}
        <if test="eformType!=null and eformType.equals('')">
            EFORM_TYPE = #eformType#
        </if>
    </select>

    <select id="selectEform001" parameterType="hashmap" resultType="camelMap" fetchSize="10000">
        SELECT
            UUID,
            CONTRACT_NUMBER AS PEN_ORD_ID,
            EFORM_TYPE,
            T_01_211 AS ITEM_NM,
            T_01_212 AS PROD_NM,
            T_01_213 AS PROD_PAY_CODE,
            T_01_214 AS PROD_BAR_NUM,
            T_01_216 AS CONTRACT_DATE,
            T_01_218 AS PROD_PRICE,
            T_01_219 AS PEN_PRICE
        FROM eform_thk001_purchaselist_view
        WHERE CONTRACT_NUMBER = #{penOrdId}
            UNION ALL
        SELECT
            UUID,
            CONTRACT_NUMBER AS PEN_ORD_ID,
            EFORM_TYPE,
            T_01_511 AS ITEM_NM,
            T_01_512 AS PROD_NM,
            T_01_513 AS PROD_PAY_CODE,
            T_01_514 AS PROD_BAR_NUM,
            CONCAT(T_01_516,'-',T_01_517) AS CONTRACT_DATE,
            T_01_518 AS PROD_PRICE,
            T_01_519 AS PEN_PRICE
        FROM eform_thk001_rentallist_view
        WHERE CONTRACT_NUMBER = #{penOrdId}
    </select>

    <insert id="insertEformMaster" parameterType="hashmap">
        INSERT
        INTO eform_master_table
        (
            UUID,
            CONTRACT_NUMBER,
            PEN_ID,
            EFORM_TYPE,
            RETURN_URL,
            EFORM_STATUS,
            CON_ACCO1,
            CON_ACCO2,
            SEQ,
            COMPANY_ID,
            BASE_YEAR,
            BASE_MONTH,
            REGISTER_DATE
        )
        VALUES
        (
            #{uuid},
            #{penOrdId},
            #{penId},
            #{eformType},
            #{returnUrl},
            '00',
            #{conAcco1},
            #{conAcco2},
            #{seq},
            #{entId},
            #{baseYear},
            #{baseMonth},
            CURRENT_TIMESTAMP
        )
    </insert>

</mapper>